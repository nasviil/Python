import customtkinter as ctk
from tkinter import *
from tkinter import ttk
import tkinter as tk
import tkinter.messagebox

ctk.set_appearance_mode("dark")
ctk.set_default_color_theme("green")

root = ctk.CTk()
root.title("SSIS")
root.geometry("400x400")
root.resizable(False, False)


def tabmain():
    root.geometry("400x300")

    def tabstudent():

        root.geometry("1000x600")
        frame.destroy()
        frame1 = ctk.CTkFrame(master=root)
        frame1.pack(pady=20, padx=20, fill="y", side="left")
        frame2 = ttk.Frame(master=root)
        frame2.pack(pady=20, padx=(0, 20), fill="both",
                    expand=True, side="right")

        label1 = ctk.CTkLabel(
            master=frame1, text="Student Information", font=("Roboto", 20))
        label1.pack(pady=(12, 24), padx=10)

        with open("courses.txt", "r") as f:
            courses = [line.strip() for line in f]

        def add_student(name, age, gpa, contact_number, course):
            # open the file in append mode
            with open('students.txt', 'a') as f:
                # write the student's information to the file
                f.write(f'{name}, {age}, {gpa}, {contact_number}, {course}\n')

        def submit_form():
            name = name_entry.get()
            age = age_entry.get()
            gpa = gpa_entry.get()
            contact_number = contact_entry.get()
            course = course_entry.get()

            # add the student to the file
            add_student(name, age, gpa, contact_number, course)

            # clear the form fields
            name_entry.delete(0, ctk.END)
            age_entry.delete(0, ctk.END)
            gpa_entry.delete(0, ctk.END)
            contact_entry.delete(0, ctk.END)

            # update the tree view with the new student information
            update_treeview()

        def update_treeview():
            # clear the tree view
            for record in treeview.get_children():
                treeview.delete(record)

            # repopulate the tree view with the updated student information
            with open('students.txt', 'r') as f:
                for line in f:
                    student_info = line.strip().split(', ')
                    treeview.insert('', 'end', values=student_info)

        def update_student(name, age, gpa, contact_number, course):
            # read all students from file
            with open('students.txt', 'r') as f:
                students = [line.strip().split(', ') for line in f.readlines()]

            # find the index of the student to update
            index = None
            for i, student in enumerate(students):
                if student[0] == name:
                    index = i
                    break

            # update the student's information
            students[index] = [name, age, gpa, contact_number, course]

            # write all students back to file
            with open('students.txt', 'w') as f:
                for student in students:
                    f.write(', '.join(student) + '\n')

            # update the tree view with the new information
            treeview.delete(*treeview.get_children())
            with open('students.txt', 'r') as f:
                for line in f.readlines():
                    student = line.strip().split(', ')
                    treeview.insert('', 'end', values=student)

        def update_form():
            # get the selected student's information
            selected = treeview.selection()
            if not selected:
                tkinter.messagebox.showerror(
                    "Error", "Please select a student to update.")
                return
            values = treeview.item(selected)['values']
            if not values:
                tkinter.messagebox.showerror(
                    "Error", "Please select a student to update.")
                return
            name, age, gpa, contact_number, course = values

            # update the student's information with the new values
            new_name = name_entry.get()
            new_age = age_entry.get()
            new_gpa = gpa_entry.get()
            new_contact_number = contact_entry.get()
            new_course = course_entry.get()
            update_student(new_name, new_age, new_gpa,
                           new_contact_number, new_course)

            # clear the form fields
            name_entry.delete(0, ctk.END)
            age_entry.delete(0, ctk.END)
            gpa_entry.delete(0, ctk.END)
            contact_entry.delete(0, ctk.END)

        def delete_student():
            # get the selected student
            selected_item = treeview.focus()
            if selected_item:
                student_info = treeview.item(selected_item, 'values')
                name, age, gpa, contact_number, course = student_info

                # open the file and read its contents
                with open('students.txt', 'r') as f:
                    lines = f.readlines()

                # remove the line with the selected student's information
                new_lines = []
                for line in lines:
                    if not line.startswith(name):
                        new_lines.append(line)

                # write the updated contents to the file
                with open('students.txt', 'w') as f:
                    f.writelines(new_lines)

                # remove the selected item from the treeview
                treeview.delete(selected_item)

        name_entry = ctk.CTkEntry(master=frame1, placeholder_text="Name")
        name_entry.pack(pady=12, padx=10)

        age_entry = ctk.CTkEntry(master=frame1, placeholder_text="Age")
        age_entry.pack(pady=12, padx=10)

        gpa_entry = ctk.CTkEntry(master=frame1, placeholder_text="GPA")
        gpa_entry.pack(pady=12, padx=10)

        contact_entry = ctk.CTkEntry(
            master=frame1, placeholder_text="Contact Number")
        contact_entry.pack(pady=12, padx=10)

        course_entry = ctk.CTkComboBox(master=frame1, values=courses)
        course_entry.pack(pady=12, padx=10)

        submit_button = ctk.CTkButton(
            master=frame1, text="Add Student", command=submit_form)
        submit_button.pack(pady=12, padx=10)

        update_button = ctk.CTkButton(
            master=frame1, text="Update Student", command=update_form)
        update_button.pack(pady=12, padx=10)

        delete_button = ctk.CTkButton(
            master=frame1, text="Delete", command=delete_student)
        delete_button.pack(pady=12, padx=10)

        def show_selected_row(event):
            # get the ID of the selected row
            selected_row_id = treeview.selection()[0]
            # get the values of the columns in the selected row
            values = treeview.item(selected_row_id, 'values')
            # display the values in the form fields
            name_entry.delete(0, ctk.END)
            name_entry.insert(0, values[0])
            age_entry.delete(0, ctk.END)
            age_entry.insert(0, values[1])
            gpa_entry.delete(0, ctk.END)
            gpa_entry.insert(0, values[2])
            contact_entry.delete(0, ctk.END)
            contact_entry.insert(0, values[3])
            course_entry.insert(0, values[4])

        # create the treeview widget in frame2
        treeview = ttk.Treeview(master=frame2)
        treeview.pack(fill="both", expand=True)

        # add columns to the treeview
        treeview["columns"] = ("name", "age", "gpa",
                               "contact_number", "course")

        # define column headings
        treeview.heading("#0", text="ID")
        treeview.heading("name", text="Name")
        treeview.heading("age", text="Age")
        treeview.heading("gpa", text="GPA")
        treeview.heading("contact_number", text="Contact Number")
        treeview.heading("course", text="Course")
        treeview.column("#0", width=50)
        treeview.column("name", width=150)
        treeview.column("age", width=50)
        treeview.column("gpa", width=50)
        treeview.column("contact_number", width=150)
        treeview.column("course", width=150)
        treeview.bind('<<TreeviewSelect>>', show_selected_row)

        # add data to the treeview
        with open('students.txt', 'r') as f:
            data = f.readlines()
            for idx, line in enumerate(data):
                student = line.strip().split(", ")
                treeview.insert(parent="", index=idx, iid=idx,
                                text=idx, values=student)

        def back():
            frame1.destroy()
            frame2.destroy()
            tabmain()

        buttonback = ctk.CTkButton(
            master=frame1, text="Back", command=back)
        buttonback.pack(side="bottom", pady=10, padx=10)

    def tabcourse():
        root.geometry("300x600")
        frame.destroy()
        frame1 = ctk.CTkFrame(master=root)
        frame1.pack(pady=20, padx=40, fill="both", expand=True)
        label1 = ctk.CTkLabel(
            master=frame1, text="Courses", font=("Roboto", 20))
        label1.pack(pady=(12, 24), padx=10)

        course_list = []

        def load_course_list():
            try:
                with open("courses.txt", "r") as f:
                    course_list.extend([line.strip()
                                       for line in f.readlines()])
            except FileNotFoundError:
                pass

        def save_course_list():
            with open("courses.txt", "w") as f:
                f.write("\n".join(course_list))

        def add_course():
            course_name = course_name_entry.get()
            if course_name:
                course_list.append(course_name)
                save_course_list()
                update_listbox()
                course_name_entry.delete(0, ctk.END)

        def update_listbox():
            course_listbox.delete(0, ctk.END)
            for course in course_list:
                course_listbox.insert(ctk.END, course)

        def delete_course():
            selected_course = course_listbox.get(ctk.ACTIVE)
            if selected_course:
                course_list.remove(selected_course)
                save_course_list()
                update_listbox()

        def edit_course():
            selected_course = course_listbox.get(ctk.ACTIVE)
            if selected_course:
                course_name_entry.delete(0, ctk.END)
                course_name_entry.insert(0, selected_course)
                delete_course()

        course_name_entry = ctk.CTkEntry(frame1)
        course_name_entry.pack(pady=12, padx=10)

        add_button = ctk.CTkButton(
            frame1, text="Add Course", command=add_course)
        add_button.pack(pady=12, padx=10)

        course_listbox = tk.Listbox(master=frame1)
        course_listbox.pack(pady=12, padx=10)

        delete_button = ctk.CTkButton(
            master=frame1, text="Delete Course", command=delete_course)
        delete_button.pack(pady=12, padx=10)

        edit_button = ctk.CTkButton(
            master=frame1, text="Edit Course", command=edit_course)
        edit_button.pack(pady=12, padx=10)

        load_course_list()
        update_listbox()

        def back():
            frame1.destroy()
            tabmain()
        buttonback = ctk.CTkButton(
            master=frame1, text="Back", command=back)
        buttonback.pack(side="bottom", pady=10, padx=10)

    frame = ctk.CTkFrame(master=root)
    frame.pack(pady=20, padx=40, fill="both", expand=True)

    label1 = ctk.CTkLabel(
        master=frame, text="Student Simple Information System", font=("Roboto", 16))
    label1.pack(pady=(12, 24), padx=10)

    buttonstudent = ctk.CTkButton(
        master=frame, text="Students", width=160, height=50, font=("Rubik", 20), command=tabstudent)
    buttonstudent.pack()
    buttonstudent.place(relx=0.5, rely=0.3, anchor=tk.CENTER)

    buttoncourse = ctk.CTkButton(
        master=frame, text="Courses", width=160, height=50, font=("Rubik", 20), command=tabcourse)
    buttoncourse.pack()
    buttoncourse.place(relx=0.5, rely=0.7, anchor=tk.CENTER)


tabmain()

root.mainloop()
